<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ’¬ Chat</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="chat-app">
    <div id="sidebar">
      <div id="sidebar-header">Chats</div>
      <input type="text" id="search-contact" placeholder="Buscar contacto...">
      <ul id="chat-list">
        <li class="public">General</li>
      </ul>
      <div id="group-creation">
        <input type="text" id="group-name" placeholder="Nombre del grupo">
        <input type="text" id="group-members" placeholder="Miembros (separados por coma)">
        <button id="create-group-btn">Crear Grupo</button>
      </div>
    </div>
    <div id="chat-panel">
      <div id="chat-header-panel">
        <span id="chat-title">General</span>
        <button id="code-btn" class="code-button">Admin</button>
      </div>
      <div id="messages"></div>
      <div id="input-area">
        <input type="text" id="message-input" placeholder="Escribe un mensaje...">
        <button id="send-btn">âž¤</button>
        <button id="image-btn">ðŸ“Ž</button>
      </div>
    </div>
    <div id="nickname-modal">
      <input type="text" id="nickname-input" placeholder="Tu nombre...">
      <button id="join-btn">Unirse</button>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
  <script src="notifications.js"></script>
  <script>
    // ConexiÃ³n al servidor Socket.IO
    const socket = io();

    // Mostrar modal de nickname al cargar
    document.getElementById('nickname-modal').style.display = 'flex';

    // Unirse al chat
    document.getElementById('join-btn').addEventListener('click', () => {
      const nickname = document.getElementById('nickname-input').value.trim();
      if (nickname) {
        socket.emit('set nickname', nickname);
        document.getElementById('nickname-modal').style.display = 'none';
      }
    });

    // Enviar mensaje pÃºblico
    document.getElementById('send-btn').addEventListener('click', () => {
      const msg = document.getElementById('message-input').value.trim();
      if (msg) {
        socket.emit('chat public', msg);
        document.getElementById('message-input').value = '';
      }
    });

    // Crear grupo
    document.getElementById('create-group-btn').addEventListener('click', () => {
      const groupName = document.getElementById('group-name').value.trim();
      const membersInput = document.getElementById('group-members').value.trim();
      const members = membersInput.split(',').map(m => m.trim()).filter(m => m);
      if (groupName && members.length > 0) {
        socket.emit('create group', { groupName, members });
        document.getElementById('group-name').value = '';
        document.getElementById('group-members').value = '';
      }
    });

    // Mostrar mensajes
    socket.on('chat message', (msg) => {
      const messagesDiv = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', msg.id === socket.id ? 'you' : 'other');
      messageDiv.innerHTML = `
        <span class="name">${msg.name} <span class="code-button">${msg.code || ''}</span></span>
        <span class="text">${msg.text || ''}</span>
        ${msg.image ? `<img src="${msg.image}" class="chat-image">` : ''}
        <span class="time">${new Date(msg.time).toLocaleTimeString()}</span>
      `;
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    // Actualizar lista de usuarios
    socket.on('user list', (userList) => {
      // AquÃ­ podrÃ­as actualizar la UI con la lista de usuarios si lo deseas
    });

    // Actualizar lista de grupos
    socket.on('group list', (groupList) => {
      const chatList = document.getElementById('chat-list');
      chatList.innerHTML = '<li class="public">General</li>';
      groupList.forEach(group => {
        const li = document.createElement('li');
        li.classList.add('group');
        li.textContent = group;
        chatList.appendChild(li);
      });
    });

    // Indicador de escritura
    socket.on('typing', ({ name, type, target }) => {
      console.log(`${name} estÃ¡ escribiendo en ${type}: ${target || 'pÃºblico'}`);
    });
  </script>
</body>
</html>
